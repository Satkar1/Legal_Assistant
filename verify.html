<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Police Verification</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin-top: 100px;
        color: #333;
      }
      .ok { color: #4caf50; }
      .err { color: #d32f2f; }
    </style>
  </head>
  <body>
    <h2>Verifying officer, please wait...</h2>

    <script>
  const token = new URLSearchParams(window.location.search).get("token");

  async function verifyOfficer() {
    if (!token) {
      document.body.innerHTML = `
        <h2 class="err">‚ùå Invalid verification link</h2>
        <p>No token provided.</p>`;
      return;
    }

    document.body.innerHTML = `<h2>Verifying officer, please wait...</h2>`;

    try {
      const res = await fetch(`https://s2004-police-dashboard.hf.space/api/verify-police?token=${token}`, {
        method: "GET",
        headers: { "Accept": "application/json" }
      });

      // Try to safely parse JSON
      const text = await res.text();
      let data;
      try {
        data = JSON.parse(text);
      } catch {
        throw new Error("Backend returned HTML instead of JSON:\n" + text.slice(0, 100));
      }

      if (data.success) {
        document.body.innerHTML = `<h2 class="ok">‚úÖ ${data.message}</h2>`;
      } else {
        document.body.innerHTML = `<h2 class="err">‚ùå ${data.error || "Verification failed"}</h2><p>${data.message || ""}</p>`;
      }

    } catch (err) {
      document.body.innerHTML = `<h2 class="err">üí• Network Error</h2><p>${err}</p>`;
    }
  }

  verifyOfficer();
</script>


  </body>
</html>
